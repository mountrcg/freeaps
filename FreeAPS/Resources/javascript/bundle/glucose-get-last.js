var freeaps_glucoseGetLast;(()=>{var e={6237:e=>{function a(e){return e.date||Date.parse(e.display_time)||Date.parse(e.dateString)}function r(e,a){a||(a=0);var r=Math.pow(10,a);return Math.round(e*r)/r}e.exports=function(e){console.error("glucosegetlasttimer start");var o=(e=e.filter((function(e){return e.glucose||e.sgv})).map((function(e){if(e.glucose=e.glucose||e.sgv,null!==e.glucose)return e}))).length;const t=e[0],u=a(t),l=a(t);var n,s=[],c=[],d=[];if(1==o)return{glucose:t.value,noise:0,delta:0,shortAvgDelta:0,longAvgDelta:0,date:l,dura_ISF_minutes:0,dura_ISF_average:t.value,slope05:0,slope15:0,slope40:0,dura_p:0,delta_pl:0,delta_pn:0,bg_acceleration:0,a_0:0,a_1:0,a_2:0,r_squ:0};for(var g=0,i=1;i<o;i++){if(void 0!==e[i]&&"cal"===e[i].type){g=i;break}if(void 0!==e[i]&&e[i].glucose>38&&e[i].device===t.device){const r=e[i],o=a(r);var v,h=0;if(void 0!==o&&void 0!==u?(v=Math.round((u-o)/6e4),n=t.glucose-r.glucose,h=n/v*5):console.error("Error: date field not found: cannot calculate avgDel"),0<v&&v<2.5)t.glucose=(t.glucose+r.glucose)/2,u=(u+o)/2;else if(2.5<v&&v<17.5)c.push(h),2.5<v&&v<7.5&&s.push(h);else{if(!(17.5<v&&v<42.5))break;d.push(h)}}}var p=0,f=0,M=0;c.length>0&&(f=c.reduce((function(e,a){return e+a}))/c.length),p=s.length>0?s.reduce((function(e,a){return e+a}))/s.length:f,d.length>0&&(M=d.reduce((function(e,a){return e+a}))/d.length);t.glucose;var _=0,b=0,w=0,k=0,S=0,m=0,D="autoISF Mod14-Debug: ";var F=t.glucose,x=t.glucose,I=0;for(i=1;i<o;i++){const r=e[i],o=a(r);if(Math.round((u-o)/6e4)-I>13)break;if(!(r.glucose>.95*x&&r.glucose<1.05*x))break;F+=r.glucose,x=F/(i+1),I=Math.round((u-o)/6e4)}_=1.05,b=1.15,w=1.4,F=0;var G,q,y=0,A=0,L=0,B=7.5;for(i=0;i<o;i++){if(G=i*A==y*y?0:(i*L-y*F)/(i*A-y*y),(q=(u-a($=e[i]))/6e4)>B&&7.5==B&&(_=5*-G,B=17.5),q>B&&17.5==B&&(b=5*-G,B=42.5),q>B&&42.5==B){w=5*-G;break}y+=q,A+=q*q,F+=$.glucose,$.glucose*$.glucose,L+=$.glucose*q}D="";var E=0,P=0,j=0,z=(k=0,S=0,m=0,0),C=0,H=0,J=0,K=0;if(o>3){var N=0,O=0,Q=0,R=0,T=0,U=0,V=0,W=a(e[0]),X=0,Y=300,Z=50;for(i=0;i<o;i++){var $,ee=(a($=e[i])-W)/1e3/Y;if(-ee*Y>2820)break;if(ee<X-1.5){i<3&&(k=-X/60,S=0,m=0,z=0,C=0,H=0,J=0,K=0);break}X=ee;var ae=$.glucose/Z;O+=ee,Q+=Math.pow(ee,2),R+=Math.pow(ee,3),T+=Math.pow(ee,4),N+=ae,U+=ee*ae,V+=Math.pow(ee,2)*ae;var re=i+1,oe=0,te=0,ue=0,le=0;if(re>3&&(oe=T*(Q*re-O*O)-R*(R*re-O*Q)+Q*(R*O-Q*Q),te=V*(Q*re-O*O)-U*(R*re-O*Q)+N*(R*O-Q*Q),ue=T*(U*re-N*O)-R*(V*re-N*Q)+Q*(V*O-U*Q),le=T*(Q*N-O*U)-R*(R*N-O*V)+Q*(R*U-Q*V)),0!=oe){var ne=te/oe;G=ue/oe;for(var se=le/oe,ce=N/re,de=0,ge=0,ie=0;ie<=i;ie++){var ve=e[ie],he=a(ve);de+=Math.pow(ve.glucose/Z-ce,2);var pe=(he-W)/1e3/Y,fe=ne*Math.pow(pe,2)+G*pe+se;ge+=Math.pow(ve.glucose/Z-fe,2)}var Me=.64;if(0!=de&&(Me=1-ge/de),re>3&&Me>=C){C=Me,k=-ee*Y/60;S=-50*(ne*Math.pow(-1,2)-1*G),m=Z*(ne*Math.pow(1,2)+1*G),z=2*ne*Z,H=se*Z,J=G*Z,K=ne*Z,E=ne*Z,P=G*Z,j=se*Z}}}D+="coeffs a/b/c=("+r(E,2)+" / "+r(P,2)+" / "+r(j,2)+"); bg date="+W+"; ",D+="Parabola Fits a0/a1/a2=("+r(H,2)+" / "+r(J,2)+" / "+r(K,2)+"); BGaccel="+z}return D+="Slopes 05/15/40=("+r(_,2)+" / "+r(b,2)+" / "+r(w,2)+"); ",console.error("glucosegetlasttimer end"),{glucose:Math.round(1e4*t.glucose)/1e4,noise:0,delta:Math.round(1e4*p)/1e4,short_avgdelta:Math.round(1e4*f)/1e4,long_avgdelta:Math.round(1e4*M)/1e4,dura_ISF_minutes:Math.round(1e4*I)/1e4,dura_ISF_average:Math.round(1e4*x)/1e4,slope05:Math.round(1e4*_)/1e4,slope15:Math.round(1e4*b)/1e4,slope40:Math.round(1e4*w)/1e4,dura_p:Math.round(1e4*k)/1e4,delta_pl:Math.round(1e4*S)/1e4,delta_pn:Math.round(1e4*m)/1e4,bg_acceleration:z,r_squ:Math.round(1e4*C)/1e4,a_0:Math.round(1e4*H)/1e4,a_1:Math.round(1e4*J)/1e4,a_2:Math.round(1e4*K)/1e4,pp_debug:D,date:u,last_cal:g,device:t.device}}}},a={};var r=function r(o){var t=a[o];if(void 0!==t)return t.exports;var u=a[o]={exports:{}};return e[o](u,u.exports,r),u.exports}(6237);freeaps_glucoseGetLast=r})();